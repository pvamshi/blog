<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>Testing private functions in Angular - Frontend Development
    </title>
    <link rel="alternate" href="http://vamshi-krishna.com/angular/feed.xml" type="application/rss+xml" title="console.log(me); // ['Javascript', 'Angular', 'React']">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Anonymous+Pro:400,700,400italic,700italic|Merriweather:400,700,300">
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body class="article-detail">
    <header class="header">
      <div class="content-wrap">
        <h1>Testing private functions in Angular</h1>
        <p class="author">Written by <span class="author">Vamshi Krishna</span>
        </p>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <section class="content"><blockquote>
<p>This is a workaround. There is no framework<span class="widont">&nbsp;</span>support.</p>
</blockquote>
<p>tl;dr : <a href="https://plnkr.co/edit/EGOOTDBUSuPltHDvEEKx?p=preview">plnkr.co/edit/EGOOTDBUSuPltHDvEEKx</a></p>
<p>AngularJS by default is a very test friendly framework. For someone who is eager to try functional programming, these days I am writing a lot of tiny private functions and I want to test them independently. Ofcourse this is not possible with the current Angular framework. To overcome this problem I tried a work around and this blog is about<span class="widont">&nbsp;</span>that.</p>
<p>Lets start with a simple<span class="widont">&nbsp;</span>example:</p>
<pre><code class="language-js">angular.module(<span class="string">'app'</span>,[])
  .service(<span class="string">'Service1'</span>,Service1);

<span class="function"><span class="keyword">function</span> <span class="title">Service1</span>(<span class="params"></span>)</span>{
  <span class="keyword">this</span>.getMessage = <span class="function"><span class="keyword">function</span>(<span class="params">num1,num2</span>)</span>{
    <span class="keyword">return</span> <span class="string">'The sum of the numbers is '</span>+sum(num1,num2);
  };
  <span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>)</span>{
    <span class="keyword">return</span> num1+num2;
  }
}</code></pre>
<p>I am not interested to test <code>getMessage</code> . I only want to test <code>sum</code> as that is where all the logic happening. My unit test file looks like<span class="widont">&nbsp;</span>this:</p>
<pre><code class="language-js">describe(<span class="string">'main tests'</span>,tests);
<span class="function"><span class="keyword">function</span> <span class="title">tests</span>(<span class="params"></span>)</span>{
  <span class="keyword">var</span> service;
  beforeEach(<span class="built_in">module</span>(<span class="string">'app'</span>));
  beforeEach(inject(<span class="function"><span class="keyword">function</span>(<span class="params">Service1</span>)</span>{
    service = Service1;
  }));

  it(<span class="string">"should return the sum"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
    expect(service.sum(<span class="number">4</span>,<span class="number">5</span>)).toBe(<span class="number">9</span>);
  });
}</code></pre>
<p>I want to get this working. But it gives<span class="widont">&nbsp;</span>error.</p>
<p>To get this working, I added another service which always gives <code>false</code> for <code>testEnabled</code> value. In general case, we never touch it, but we will set it to <code>true</code> during testing. This way we can convert private functions to public during test and leave them private in general<span class="widont">&nbsp;</span>cases.</p>
<pre><code class="language-js">angular.module(<span class="string">'app'</span>,[])
  .service(<span class="string">'Service1'</span>,Service1)
  .service(<span class="string">'Service2'</span>,Service2);

<span class="comment">//Service2 code</span>

<span class="function"><span class="keyword">function</span> <span class="title">Service1</span>(<span class="params"></span>)</span>{
  <span class="keyword">this</span>.getMessage = <span class="function"><span class="keyword">function</span>(<span class="params">num1,num2</span>)</span>{
    <span class="keyword">return</span> <span class="string">'The sum of the numbers is '</span>+sum(num1,num2);
  };
  <span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>)</span>{
    <span class="keyword">return</span> num1+num2;
  }

  <span class="keyword">if</span>(Service2.testEnabled){
    <span class="keyword">this</span>.sum = sum;
  }
}</code></pre>
<p>Now we can continue with unit<span class="widont">&nbsp;</span>tests.</p>
<pre><code class="language-js">angular.module(<span class="string">'app'</span>,[])
  .service(<span class="string">'Service1'</span>,Service1)
  .service(<span class="string">'Service2'</span>,Service2);


describe(<span class="string">'main tests'</span>,tests);
<span class="function"><span class="keyword">function</span> <span class="title">tests</span>(<span class="params"></span>)</span>{
  <span class="keyword">var</span> service, service2;
  beforeEach(<span class="built_in">module</span>(<span class="string">'app'</span>));
  beforeEach(inject(<span class="function"><span class="keyword">function</span>(<span class="params">Service2</span>)</span>{
    service2 = Service2;
    service2.enableTest();
  }));
  beforeEach(inject(<span class="function"><span class="keyword">function</span>(<span class="params">Service1</span>)</span>{
    service = Service1;
  }));

  it(<span class="string">"should return the name"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
    expect(service.sum(<span class="number">4</span>,<span class="number">5</span>)).toBe(<span class="number">9</span>);
  });
}</code></pre>
<p>Works great !!</p>
<p>The same can be used for private functions in Controllers<span class="widont">&nbsp;</span>too.</p>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/">&laquo; All blogs</a></div>
        <section class="about"><p>I am a frontend developer working for <a href="http://syncron.com/">Syncron</a> 
located at Bengaluru. I blog to record and share technical learnings in day today life. </p>

        </section>
        <section class="copy">
          <p>&copy; 2019 Vamshi Krishna &mdash; powered by&nbsp;<a href="https://github.com/jnordberg/wintersmith">Wintersmith</a></p>
        </section>
      </div>
    </footer>
  </body>
</html>